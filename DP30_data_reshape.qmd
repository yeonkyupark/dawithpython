# 데이터 변형 

데이터 변형은 적재한 데이터가 분석에 용이한 형태로 자료형이나 구조를 바꾸는 방법이다. wide format을 long format으로 변형하거나 범주형 변수를 원핫 인코딩을 통해 수치형 변수로 바꾸는 등이 이에 해당한다.

실습 코드는 Palmer Penguins 데이터셋을 이용한다.

```{python}
import pandas as pd
from palmerpenguins import load_penguins

df = load_penguins()
df.head()
```

## 자료형 처리

```{python}
df.dtypes
```

`species`, `island`, `sex`는 문자열 자료형인 `object`로 적재되었다. 이 자료형을 범주 자료형으로 변환한다.

```{python}
df_cat = df.copy()

cat_cols = ['species', 'island', 'sex']
df_cat[cat_cols] = df[cat_cols].astype('category')

df_cat.dtypes 
```

`astype()` 함수는 넘파이 배열이나 판단스 데이터프레임에 있는 컬럼 요소의 자료형을 변환하는 함수이다.  


```python
DataFrame.astype(dtype, copy=True, errors='raise')
```

`dtype`은 변경할 자료형을 뜻한다. 
- int, float, str, bool, category, datetime64 등

## 데이터 구조 변형

### 특정 컬럼 추출 및 파생 변수 생성

```{python}
df_cols = df[['species', 'bill_length_mm', 'bill_depth_mm']].copy()

df_cols['bill_ratio'] = df_cols['bill_length_mm'] / df_cols['bill_depth_mm']

df_cols.head()

```

### 자료 구조 변경

#### Long format을 Wide format으로 변경

Long format으로 구성된 자료를 Wide format으로 변경한다.

```{python}
df_long = df[['species', 'body_mass_g']].copy().reset_index()
# 범주별 인덱스 부여
df_long['index'] = df_long.groupby('species').cumcount()

df_long01 = df_long.pivot(index='index', columns='species', values='body_mass_g')
df_long01
```

```{python}
df_long = df[['species', 'body_mass_g']].copy().reset_index()

df_long02 = df_long.pivot_table(index=None, columns='species', values='body_mass_g',
aggfunc='mean'
)
df_long02
```

```{python}
df_long = df[['species', 'body_mass_g']].copy().reset_index()

df_long03 = df_long.pivot_table(index=None, columns='species', values='body_mass_g',
aggfunc='count'
)
df_long03
```

#### Wide format을 Long format으로 변경

`df_long01` 데이터프레임을 이용하여 wide format을 long format으로 변경한다.
```{python}
df_long02 = df_long01.reset_index()

# df_long02
df_long02.melt(id_vars='index', var_name='species', value_name='body_mass_g')
```

## 범주형 데이터 처리

### 더미 변수 생성

조건문을 통해 간단히 더미 변수를 생성할 수 있다.

```{python}
df_dum = df[['species', 'sex']].copy()

df_dum['is_male'] = (df_dum['sex'] == 'male')*1

df_dum.head()
```

### 원핫 인코딩

판다스 `pd.get_dummies()` 함수를 이용하여 간단히 더미 변수를 생성할 수 있다.

```{python}
df_dum = df[['species', 'sex']].copy()

pd.get_dummies(df_dum, columns=['species'], drop_first=True)
```

`drop_first=True` 인자를 통해 생성된 더비 변수 중 기준 범주 하나(첫 번째 변수)를 제거한다. 모든 범주를 더미화하게 되면 선형회귀에 있어 다중공선성 문제가 발생할 수 있다.